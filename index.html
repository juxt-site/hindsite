<!DOCTYPE html>
<html>
  <head>
    <title>HindSite demo</title>
    <link rel="icon" href="data:,">

    <link rel="stylesheet" href="tufte-css/tufte.css"/>

    <script src="htmx/htmx.min.js"></script>

    <style>
      table {
	  border: 1px solid black;
	  border-collapse: collapse;
      }
      table td {
	  border: 1px solid black;
	  padding: 2pt;
      }
    </style>

  </head>

  <body>

    <h1>HindSite demo</h1>

    <h2>Login</h2>
    <a href="https://auth.site.test/oauth/authorize?client_id=hindsite&response_type=token">Login</a>

    <p>Access Token: <tt id="access-token"></tt></p>

    <h2>List of operations</h2>

    <p>Until we acquire an <i>access token</i>, these will be just the 'public' operations!</p>

    <div class="authorized"
	 hx-get="https://data.site.test/_site/operations.html"
	 hx-trigger="load">
      <code>
	Loading operations...
      </code>
    </div>

    <h2>List of users</h2>

    <div class="authorized"
	 hx-get="https://data.site.test/_site/users.html"
	 hx-trigger="load">
      <code>
	Loading users...
      </code>
      <aside>(note: this won't complete until we have authorization working!)</aside>
    </div>

    <script>
      const accessToken = new URLSearchParams(location.hash.substring(1)).get("access_token");
      document.getElementById("access-token").innerText = accessToken;

      const getAuthorizationHeader = function () { "Bearer" + accessToken };

      for (const el of document.getElementsByClassName("authorized")) {
	el.setAttribute("hx-headers",
			JSON.stringify({"authorization": "Bearer " + accessToken}))
      }
    </script>

  </body>
</html>
